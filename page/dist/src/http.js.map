{"version":3,"sources":["../../src/http.js"],"names":["types","axiosInstance","create","baseURL","process","env","API_ROOT","timeout","withCredentials","headers","transformRequest","data","stringify","interceptors","request","use","state","event","token","config","Authorization","reject","err","response","error","status","commit","USER_SIGNOUT","replace","path","query","redirect","currentRoute","fullPath"],"mappings":";;;;;;;;;;AAKA;;;;AACA;;;;AACA;;IAAYA,K;;AACZ;;;;AAIA;;;;;;;;AACA,IAAMC,gBAAgB,gBAAMC,MAAN,CAAa;AACjCC,WAASC,QAAQC,GAAR,CAAYC,QADY;AAEjCC,WAAS,KAFwB;AAGjCC,mBAAiB,IAHgB;AAIjCC,WAAS;AACP,oBAAgB,mCADT;;AAGP,mCAA+B,GAHxB;AAIP,wCAAoC,MAJ7B;AAKP,oCAAgC,gDALzB;AAMP,wBAAoB;AANb,GAJwB;AAYjCC,oBAAkB,CAAC,UAAUC,IAAV,EAAgB;AACjCA,WAAO,aAAGC,SAAH,CAAaD,IAAb,CAAP;AACA,WAAOA,IAAP;AACD,GAHiB;;AAZe,CAAb,CAAtB;;AAoBAV,cAAcY,YAAd,CAA2BC,OAA3B,CAAmCC,GAAnC,CACE,kBAAU;AACR,MAAI,gBAAMC,KAAN,CAAYC,KAAZ,CAAkBC,KAAtB,EAA6B;AAC3BC,WAAOV,OAAP,CAAeW,aAAf,eAAyC,gBAAMJ,KAAN,CAAYC,KAAZ,CAAkBC,KAA3D;AACD;AACD,SAAOC,MAAP;AACD,CANH,EAOE,eAAO;AACL,SAAO,kBAAQE,MAAR,CAAeC,GAAf,CAAP;AACD,CATH;;AAYArB,cAAcY,YAAd,CAA2BU,QAA3B,CAAoCR,GAApC,CACE,oBAAY;AACV,SAAOQ,QAAP;AACD,CAHH,EAIE,iBAAS;AACP,MAAIC,MAAMD,QAAV,EAAoB;AAClB,YAAQC,MAAMD,QAAN,CAAeE,MAAvB;AACE,WAAK,GAAL;AAEE,wBAAMC,MAAN,CAAa1B,MAAM2B,YAAnB;AACA,yBAAOC,OAAP,CAAe;AACbC,gBAAM,QADO;AAEbC,iBAAO;AACLC,sBAAU,iBAAOC,YAAP,CAAoBC;AADzB;AAFM,SAAf;AAJJ;AAWD;;AAED,SAAO,kBAAQZ,MAAR,CAAeG,MAAMD,QAAN,CAAeZ,IAA9B,CAAP;AACD,CApBH;;kBAsBeV,a","file":"http.js","sourcesContent":["/**\r\n * Created by superman on 17/2/16.\r\n * http配置\r\n */\r\n\r\nimport axios from 'axios'\r\nimport store from './store/index'\r\nimport * as types from './store/mutation-types'\r\nimport router from './router'\r\n\r\n// npm install axios的时候默认会安装qs\r\n// qs相关的问题请搜索\"nodejs qs\"或者看这里https://www.npmjs.com/package/qs\r\nimport Qs from 'qs'\r\nconst axiosInstance = axios.create({\r\n  baseURL: process.env.API_ROOT,\r\n  timeout: 50000,\r\n  withCredentials: true,\r\n  headers: {\r\n    'Content-Type': 'application/x-www-form-urlencoded',\r\n    // 'Access-Control-Allow-Origin': 'http://mc.taihuoniao.com',\r\n    'Access-Control-Allow-Origin': '*',\r\n    'Access-Control-Allow-Credentials': 'true',\r\n    'Access-Control-Allow-Headers': 'Origin, X-Requested-With, Content-Type, Accept',\r\n    'X-Requested-With': 'XMLHttpRequest'\r\n  },\r\n  transformRequest: [function (data) {\r\n    data = Qs.stringify(data)\r\n    return data\r\n  }]\r\n\r\n})\r\n\r\n// http request 拦截器\r\naxiosInstance.interceptors.request.use(\r\n  config => {\r\n    if (store.state.event.token) {\r\n      config.headers.Authorization = `Bearer ${store.state.event.token}`\r\n    }\r\n    return config\r\n  },\r\n  err => {\r\n    return Promise.reject(err)\r\n  })\r\n\r\n// http response 拦截器\r\naxiosInstance.interceptors.response.use(\r\n  response => {\r\n    return response\r\n  },\r\n  error => {\r\n    if (error.response) {\r\n      switch (error.response.status) {\r\n        case 401:\r\n          // 401 清除token信息并跳转到登录页面\r\n          store.commit(types.USER_SIGNOUT)\r\n          router.replace({\r\n            path: '/login',\r\n            query: {\r\n              redirect: router.currentRoute.fullPath\r\n            }\r\n          })\r\n      }\r\n    }\r\n    // console.log(JSON.stringify(error));//console : Error: Request failed with status code 402\r\n    return Promise.reject(error.response.data)\r\n  })\r\n\r\nexport default axiosInstance\r\n"]}